{% extends "basic.html" %}
    {% block title %}
    <div id="fb-root"></div>
    <!-- <script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v11.0&appId=201932648371956&autoLogAppEvents=1" nonce="tRCLLQrM"></script> -->
    <title>註冊 / Scard</title>
    {% endblock %}

    {% block main %}
    <main class="container mx-auto row mt-5">
        <form class="col-10 col-md-8 col-lg-6 p-4 bg-white rounded mx-auto signup"> 
            <h3>註冊 / 登入</h3>
            <div class="mb-3">
                <label for="email" class="form-label">常用信箱</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">密碼</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <p class="message"></p>
            <div class="d-flex justify-content-end">
                <button type="submit" class="btn bg-scard-l text-white">註冊 / 登入</button>
            </div>
        </form>
        
        <div class="fb-login-button" data-width="" data-size="large" data-button-type="login_with" data-layout="default" data-auto-logout-link="false" data-use-continue-as="false" onc></div>
    </main>
    {% endblock %}
    
    {% block JS %}
    <script>
        const fbBtn = document.querySelector('.fb-login-button')
        fbBtn.addEventListener("click", function (e) {
            e.preventDefault()
            checkLoginState()
        })
        function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
            console.log('statusChangeCallback');
            console.log(response);                   // The current login status of the person.
            if (response.status === 'connected') {   
                // Logged into your webpage and Facebook.
            } else {                                 // Not logged into your webpage or we are unable to tell.
                testAPI();  
                console.log('沒有連上 笑死')
                // document.getElementById('status').innerHTML = 'Please log ' +
            //     'into this webpage.';
            }
        }


        function checkLoginState() {               // Called when a person is finished with the Login Button.
            FB.getLoginStatus(function(response) {   // See the onlogin handler
                statusChangeCallback(response);
            });
        }

        function testAPI() {                      // Testing Graph API after login.  See statusChangeCallback() for when this call is made.
            console.log('Welcome!  Fetching your information.... ');
            FB.api('/me?fields=id,email', function(res) {
                console.log('Successful login for: ' + res.id + res.email);
                // document.getElementById('status').innerHTML =
                //     'Thanks for logging in, ' + response.name + '!';
            });
        }

        window.fbAsyncInit = function() {
            FB.init({
                appId      : '164377919057019',
                cookie     : true,  
                xfbml      : true,
                version    : 'v11.0'
            });
            FB.AppEvents.logPageView();

            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
        };
      
        (function(d, s, id){
           var js, fjs = d.getElementsByTagName(s)[0];
           if (d.getElementById(id)) {return;}
           js = d.createElement(s); js.id = id;
           js.src = "https://connect.facebook.net/zh_TW/sdk.js";
           fjs.parentNode.insertBefore(js, fjs);
         }(document, 'script', 'facebook-jssdk'));
    </script>

    <!-- <script>
        function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
            console.log('statusChangeCallback');
            console.log(response);                   // The current login status of the person.
            if (response.status === 'connected') {   // Logged into your webpage and Facebook.
                testAPI();  
            } else {                                 // Not logged into your webpage or we are unable to tell.
            // document.getElementById('status').innerHTML = 'Please log ' +
            //     'into this webpage.';
                console.log('not connect')
            }
        }

        function testAPI() {  // Testing Graph API after login.  See statusChangeCallback() for when this call is made.
            console.log('Welcome!  Fetching your information.... ');
            FB.api('/me', function(response) {
            console.log('Successful login for: ' + response.name);
            // document.getElementById('status').innerHTML =
            //     'Thanks for logging in, ' + response.name + '!';
            });
        }

        function checkLoginState() {  // Called when a person is finished with the Login Button.
            FB.getLoginStatus(function(response) {   // See the onlogin handler
                statusChangeCallback(response);
            });
        }

        window.fbAsyncInit = function() {
            FB.init({
                appId      : '164377919057019',
                cookie     : true,
                xfbml      : true,
                version    : 'v11.0'
            });
                
            FB.getLoginStatus(function(response) {   // Called after the JS SDK has been initialized.
                statusChangeCallback(response);        // Returns the login status.
            });

        }

        
        const fbBtn = document.querySelector('.fb-login-button')
        fbBtn.addEventListener('click', ()=>{
            FB.login(function(response) {
                if (response.status === 'connected') {
                    // Logged into your webpage and Facebook.
                    console.log('login!!!!')
                } else {
                    // The person is not logged into your webpage or we are unable to tell. 
                }
            });
        })
        
        
        // (function(d, s, id){
        //     var js, fjs = d.getElementsByTagName(s)[0];
        //     if (d.getElementById(id)) {return;}
        //     js = d.createElement(s); js.id = id;
        //     js.src = "https://connect.facebook.net/zh_TW/sdk.js";
        //     fjs.parentNode.insertBefore(js, fjs);
        // }(document, 'script', 'facebook-jssdk'));
    </script> -->
   
    
    <script src="/static/js/signup.js"></script>
    {% endblock %}
